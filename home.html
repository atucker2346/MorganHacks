
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech Analysis</title>
    <style>
        /* --- Global Styles & Variables --- */
        :root {
            --page-bg-color: #000; /* Black background for content sections and body */
            --primary-purple: #8a2be2; /* Blue Violet */
            --light-purple: #9370db; /* Medium Purple */
            --text-color: #f0f0f0;
            --border-color: rgba(255, 255, 255, 0.2);
            --box-bg: rgba(40, 40, 40, 0.3); /* Slightly transparent dark bg for feature items */
            --glass-box-bg: rgba(138, 43, 226, 0.1); /* More transparent purple for glass boxes */
            --glass-box-border: rgba(147, 112, 219, 0.5); /* Semi-transparent purple border */
            --blur-amount: 8px;
            --border-radius: 12px;
            --content-max-width: 1200px; /* Retained for centering specific grids/content */
            --readable-text-max-width: 800px; /* Max width for text paragraphs */
            --glow-color: rgba(147, 112, 219, 0.5); /* Light purple glow */
            --text-glow-color: rgba(147, 112, 219, 0.7); /* Slightly stronger purple for text glow */
        }


        /* Basic reset and box-sizing */
        * { box-sizing: border-box; margin: 0; padding: 0; }


        html {
             scroll-behavior: smooth; /* Optional: smooth scrolling */
        }


        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: var(--page-bg-color); /* Changed body background to black */
            color: var(--text-color);
            line-height: 1.6;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden; /* Still prevent horizontal scroll */
        }


        /* --- Header Styles --- */
        header {
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;
            padding: 15px 3%; /* Adjusted padding */
            border-bottom: 1px solid var(--primary-purple);
            background-color: rgba(26, 26, 26, 0.8); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
            position: sticky; top: 0; z-index: 100; width: 100%;
        }
        header h1 { font-size: 1.8em; color: var(--primary-purple); text-transform: uppercase; letter-spacing: 1px; margin: 0; }
        header nav { margin: 0; }
        header nav a { color: var(--text-color); text-decoration: none; margin-left: 25px; font-size: 1.1em; transition: color 0.3s ease; padding: 5px 0; border-bottom: 2px solid transparent; }
        header nav a:hover, header nav a:focus { color: var(--light-purple); outline: none; }
        header nav a.active { color: var(--light-purple); border-bottom-color: var(--light-purple); font-weight: bold; }


        /* --- Page Container --- */
        .page-container {
            width: 100%;
            margin: 0 auto;
            padding: 0; /* Sections handle padding */
            flex-grow: 1;
        }


        /* --- Page Section Styling --- */
        .page {
            display: none;
            padding-top: 30px; /* Add padding to top of pages */
            padding-left: 3%; /* Add side padding to pages */
            padding-right: 3%; /* Add side padding to pages */
        }
        .page.active { display: block; }
        /* Set black background for page content areas, except home */
        #practice-page, #history-page, #save-note-page {
             background-color: var(--page-bg-color);
             padding-bottom: 40px; /* Add padding at the bottom */
             margin-top: -1px; /* Prevent potential margin collapse issues */
        }
        /* Remove top padding from home page as hero section handles it */
        #home-page { padding-top: 0; padding-left: 0; padding-right: 0; }




        /* --- Home Page Specific Styles --- */
        #home-page { text-align: center; }


        /* Hero Section (Welcome + Animation) - Stays full width */
        .hero-section {
            position: relative; /* Needed for absolute positioning of iframe */
            padding: 80px 3% 60px; /* Use percentage padding */
            height: 100vh; /* Make hero section full viewport height */
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            overflow: hidden; /* Important to contain the iframe */
            background-color: #111; /* Fallback background */
        }


        /* --- Spline iframe Container --- */
        .spline-iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: 0; /* Behind the content */
            opacity: 0.85; /* Slightly reduced opacity */
            /* --- Scrolling Fix --- */
            pointer-events: none;
        }


        /* Ensure content is above the spline iframe */
        #home-page .hero-section .cta-button {
            position: relative;
            z-index: 1; /* Keep content above spline iframe (z-index 0) */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.6); /* Added shadow for readability */
            margin-top: 30px; /* Added margin to move button down */
        }


        /* --- Glassy CTA Button --- */
        .cta-button {
            display: inline-block;
            padding: 15px 35px;
            background-color: var(--glass-box-bg); /* Use glassy background variable */
            color: var(--text-color);
            border: 1px solid var(--border-color); /* Add subtle border */
            border-radius: var(--border-radius); /* Use consistent border radius */
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            backdrop-filter: blur(var(--blur-amount)); /* Apply blur */
            -webkit-backdrop-filter: blur(var(--blur-amount)); /* Apply blur for Safari */
            /* Updated transition to include box-shadow */
            transition: background-color 0.3s ease, transform 0.1s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }


        .cta-button:hover, .cta-button:focus {
            background-color: rgba(147, 112, 219, 0.4); /* Slightly less transparent light purple on hover */
            border-color: rgba(255, 255, 255, 0.4); /* Slightly brighter border on hover */
            outline: none; /* Remove default focus outline */
            transform: scale(1.05);
            /* Added box-shadow for glow effect */
            box-shadow: 0 0 15px 5px var(--glow-color);
        }


        .cta-button:active {
            transform: scale(0.98);
            box-shadow: none; /* Optional: remove glow on active click */
        }


        /* Features Section */
        .features-section {
            padding: 60px 3%; /* Use percentage padding */
            background-color: var(--page-bg-color); /* Changed background to black */
            min-height: 50vh; /* Ensure it has some height */
        }
        .features-section h3 {
            text-align: center;
            font-size: 2em;
            color: var(--light-purple);
            margin-bottom: 40px;
            /* Added text glow */
            text-shadow: 0 0 8px var(--text-glow-color);
        }
        /* Keep the grid itself centered and max-width */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: var(--content-max-width); /* Apply max-width here */
            margin: 0 auto; /* Center the grid within the full-width section */
        }
        .feature-item {
            background: var(--box-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            border: 1px solid var(--primary-purple); /* Use primary purple for border */
            backdrop-filter: blur(var(--blur-amount));
            -webkit-backdrop-filter: blur(var(--blur-amount));
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Added box-shadow transition */
        }
        .feature-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(138, 43, 226, 0.3); /* Add purple glow on hover */
        }
        .feature-icon { font-size: 2.5em; color: var(--primary-purple); margin-bottom: 15px; display: inline-block; width: 50px; height: 50px; line-height: 50px; border: 1px solid var(--primary-purple); border-radius: 50%; }
        .feature-item h4 {
            font-size: 1.3em;
            color: var(--light-purple);
            margin-bottom: 10px;
            /* Added text glow */
            text-shadow: 0 0 6px var(--text-glow-color);
        }
        .feature-item p { font-size: 1em; color: var(--text-color); opacity: 0.9; }


        /* --- Practice Page Styles --- */
        /* Apply max-width to the main content area of practice page */
        #practice-page main {
            display: flex;
            flex-direction: column;
            gap: 30px; /* Increased gap between rows */
            max-width: var(--content-max-width); /* Center content */
            margin: 0 auto; /* Center the main content */
        }
        .content-row { display: flex; flex-wrap: wrap; gap: 30px; /* Increased gap between columns */ }
        /* Updated glass-box styles for practice page */
        .glass-box {
            border-radius: var(--border-radius);
            padding: 30px; /* Increased padding */
            border: 1px solid var(--glass-box-border); /* Use semi-transparent purple border */
            background: var(--glass-box-bg); /* Use glassy purple background */
            backdrop-filter: blur(var(--blur-amount));
            -webkit-backdrop-filter: blur(var(--blur-amount));
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            flex-grow: 1;
            min-width: 280px; /* Keep minimum width */
        }
        /* Add glow to Practice Page section headings */
        .glass-box h2 {
            color: var(--light-purple);
            margin-top: 0;
            margin-bottom: 20px; /* Increased margin */
            border-bottom: 1px solid var(--glass-box-border);
            padding-bottom: 10px; /* Increased padding */
            text-align: center;
            font-size: 1.4em; /* Slightly larger heading */
            text-shadow: 0 0 6px var(--text-glow-color); /* Added glow */
        }
        .video-area { flex-basis: calc(60% - 15px); display: flex; justify-content: center; align-items: center; min-height: 350px; /* Increased min-height */ font-size: 5em; color: rgba(255, 255, 255, 0.3); background-color: rgba(0,0,0,0.2); border-radius: var(--border-radius); border: 1px solid var(--glass-box-border); /* Added border to video area */ }
        .feedback-box { flex-basis: calc(40% - 15px); min-height: 350px; /* Increased min-height */ }
        /* Added min-height to bottom row boxes */
        .speech-stats, .tips-improvement, .generated-notes {
            flex-basis: calc(33.333% - 20px); /* Adjusted basis for increased gap */
            min-height: 250px; /* Added minimum height */
            display: flex; /* Use flexbox for vertical alignment if needed */
            flex-direction: column;
        }
        .tips-improvement { justify-content: space-between; } /* Keep button at bottom */


        ul { list-style: none; padding-left: 0; margin-bottom: 15px; /* Add some space below lists */ }
        li { margin-bottom: 12px; /* Slightly increase spacing */ padding-left: 20px; position: relative; font-size: 1.05em; /* Slightly larger list text */}
        li::before { content: '‚Ä¢'; color: var(--primary-purple); font-weight: bold; display: inline-block; width: 1em; margin-left: -1.2em; position: absolute; left: 10px; }


        /* Style specific list items */
        #feedback-content p { margin-bottom: 10px; }
        #tips-list li { margin-bottom: 8px; }
        #notes-list .note-text {
             white-space: normal; /* Allow text wrapping */
             word-wrap: break-word; /* Break long words */
             height: auto; /* Allow height to adjust */
             min-height: 30px; /* Keep minimum height */
             background: none; /* Remove the line background */
             padding: 5px 0;
             font-size: 0.95em; /* Adjust note text size if needed */
        }
        .note-card {
            min-height: 50px; /* Ensure note card has some base height */
            align-items: flex-start; /* Align icon to top */
            padding-top: 12px;
            padding-bottom: 12px;
        }
        .note-icon { margin-top: 3px; } /* Align icon better with first line of text */


        /* Style Save button */
        .save-button {
            display: block;
            width: 100%;
            padding: 12px 20px;
            background-color: var(--primary-purple);
            color: var(--text-color);
            border: none; /* Removed border */
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            margin-top: auto; /* Pushes button to bottom in flex container */
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease; /* Added box-shadow transition */
        }
        .save-button:hover:not(:disabled), .save-button:focus:not(:disabled) {
            background-color: var(--light-purple);
            outline: none; /* Remove default focus outline */
            box-shadow: 0 0 12px 4px var(--glow-color); /* Added glow */
        }
        .save-button:active:not(:disabled) {
            transform: scale(0.98);
            box-shadow: none; /* Remove glow on click */
        }
        .save-button:disabled {
             background-color: #555; /* Grey out when disabled */
             cursor: not-allowed;
             opacity: 0.7;
        }


        .note-card { display: flex; background: rgba(0, 0, 0, 0.2); padding: 10px; border-radius: 6px; margin-bottom: 10px; border: 1px solid var(--glass-box-border); }
        .note-icon { width: 30px; height: 30px; flex-shrink: 0; border: 1px solid var(--glass-box-border); margin-right: 15px; display: flex; justify-content: center; align-items: center; color: var(--light-purple); font-size: 1.5em; line-height: 1; }
        .note-text { flex-grow: 1; } /* Removed fixed height and background lines */


        /* History & Save Note Pages */
         #history-page h2, #save-note-page h2 {
             text-align: center;
             color: var(--light-purple);
             text-shadow: 0 0 8px var(--text-glow-color); /* Added glow */
             margin-bottom: 20px; /* Added margin */
         }
         #history-page p, #save-note-page p {
             text-align: center;
             max-width: var(--readable-text-max-width); /* Limit width */
             margin: 0 auto 20px auto; /* Center paragraph and add bottom margin */
             opacity: 0.8; /* Slightly fade text */
         }


         /* Style for loading state */
        .loading-text {
            font-style: italic;
            color: var(--light-purple);
            opacity: 0.7;
            display: inline; /* Ensure it's visible */
        }
        .loading-block { /* For paragraph/list placeholders */
            font-style: italic;
            color: var(--light-purple);
            opacity: 0.7;
            display: block; /* Ensure it's visible */
            margin-bottom: 10px;
        }




        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 20px 3%; /* Use percentage padding */
            margin-top: 40px;
            color: var(--light-purple); /* Use light purple for footer text */
            font-size: 0.9em;
            border-top: 1px solid var(--border-color);
            background-color: var(--page-bg-color); /* Match page background */
        }




        /* --- Responsive Adjustments --- */
        @media (max-width: 900px) { .content-row { gap: 20px; } .video-area, .feedback-box, .speech-stats, .tips-improvement, .generated-notes { flex-basis: 100%; min-width: 0; min-height: auto; /* Remove fixed min-height for stacking */ } .video-area { min-height: 300px; } /* Keep video area reasonably sized */ .features-grid { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { header { flex-direction: column; align-items: flex-start; padding: 15px 5%; } header h1 { margin-bottom: 10px; } header nav { margin-left: -25px; margin-bottom: 5px; } header nav a { margin-left: 25px; font-size: 1em; } .cta-button { font-size: 1.1em; padding: 12px 25px; } .features-section h3 { font-size: 1.8em; } #practice-page, #history-page, #save-note-page { padding-top: 20px; padding-bottom: 30px; padding-left: 5%; padding-right: 5%; } .page {padding-left: 5%; padding-right: 5%;} .hero-section {padding: 80px 5% 60px; min-height: auto; height: auto;} /* Adjust hero height on smaller screens */ .features-section {padding: 60px 5%;} footer {padding: 20px 5%;} .glass-box { padding: 20px; } .glass-box h2 { font-size: 1.3em; } }
        @media (max-width: 480px) { .page-container { padding: 0; } header { padding: 10px 15px; } header h1 { font-size: 1.5em; } .glass-box { padding: 15px; } .glass-box h2 { font-size: 1.1em; } .video-area { min-height: 200px; font-size: 3em; } li { font-size: 0.95em; } .save-button { padding: 10px 15px; font-size: 0.95em; } .note-icon { width: 25px; height: 25px; font-size: 1.2em; margin-right: 10px; } .note-text { height: auto; background: none; } .hero-section { padding: 60px 15px 40px; } .cta-button { font-size: 1em; padding: 10px 20px; } .features-section { padding: 40px 15px; } .features-section h3 { font-size: 1.6em; } .feature-item h4 { font-size: 1.1em; } .feature-item p { font-size: 0.9em; } footer { font-size: 0.8em; margin-top: 20px; padding: 20px 15px; } #practice-page, #history-page, #save-note-page { padding-top: 15px; padding-bottom: 25px; padding-left: 15px; padding-right: 15px; } .page {padding-left: 15px; padding-right: 15px;} }


    </style>
</head>
<body>


    <header>
        <h1>Speech Analysis</h1>
        <nav id="main-nav">
            <a href="#home" data-page="home-page" class="active">Home</a>
            <a href="#practice" data-page="practice-page">Practice</a>
            <a href="#history" data-page="history-page">History</a>
            <a href="#save-note" data-page="save-note-page">Save Note</a>
        </nav>
    </header>


    <div class="page-container">
        <section id="home-page" class="page active">
            <div class="hero-section">
                <iframe
                  class="spline-iframe"
                  src="https://my.spline.design/claritystream-vlh8q7RMRQu4axdnwAQYvkKk/"
                  allowfullscreen
                  aria-hidden="true" tabindex="-1" ></iframe>
                <a href="#practice" class="cta-button" data-page="practice-page">Start Practicing Now</a>
            </div>
            <section class="features-section">
                <h3>Key Features</h3>
                <div class="features-grid">
                    <div class="feature-item"><div class="feature-icon">üìä</div><h4>Real-time Statistics</h4><p>Monitor your words per minute (WPM), pacing, and filler word usage as you speak.</p></div>
                    <div class="feature-item"><div class="feature-icon">üí°</div><h4>Actionable Feedback</h4><p>Receive instant suggestions and tips tailored to improve your delivery and clarity.</p></div>
                    <div class="feature-item"><div class="feature-icon">üìù</div><h4>Note Generation</h4><p>Automatically generate key points or note cards from your practice sessions.</p></div>
                </div>
            </section>
        </section>


        <section id="practice-page" class="page">
            <main>
                <div class="content-row">
                    <div class="glass-box video-area" aria-label="Live Video Feed Placeholder">
                        <span id="video-placeholder-icon">üé§</span> </div>
                    <section class="glass-box feedback-box" aria-labelledby="feedback-heading">
                        <h2 id="feedback-heading">FEEDBACK</h2>
                        <div id="feedback-content">
                             <p class="loading-block">Waiting for practice data...</p>
                        </div>
                    </section>
                </div>
                <div class="content-row">
                    <section class="glass-box speech-stats" aria-labelledby="stats-heading">
                        <h2 id="stats-heading">SPEECH STATISTICS</h2>
                        <ul>
                            <li>WPM: <span id="wpm-value" class="loading-text">(...)</span></li>
                            <li>Pacing: <span id="pacing-value" class="loading-text">(...)</span></li>
                            <li>Filler words: <span id="filler-count" class="loading-text">(...)</span></li>
                        </ul>
                        <p style="margin-top: 15px; font-weight: bold;">Transcript:</p>
                        <textarea id="transcript-display" rows="5" readonly style="width: 100%; background: rgba(0,0,0,0.2); color: var(--text-color); border: 1px solid var(--glass-box-border); border-radius: 4px; padding: 8px; margin-top: 5px; font-size: 0.9em; resize: vertical;"></textarea>
                    </section>
                     <section class="glass-box tips-improvement" aria-labelledby="tips-heading">
                        <div>
                            <h2 id="tips-heading">TIPS FOR IMPROVEMENT</h2>
                            <ul id="tips-list">
                                <li class="loading-block">Waiting for tips...</li>
                            </ul>
                        </div>
                        <button class="save-button" id="saveSpeechButton" disabled>SAVE SPEECH (Coming Soon)</button>
                    </section>
                    <section class="glass-box generated-notes" aria-labelledby="notes-heading">
                        <h2 id="notes-heading">GENERATED NOTE CARDS</h2>
                        <div id="notes-list">
                            <p class="loading-block">Waiting for notes...</p>
                            </div>
                    </section>
                </div>
            </main>
        </section>


        <section id="history-page" class="page">
             <div>
                 <h2>History Page</h2>
                 <p>Your past practice sessions will be listed here. Review your progress, identify patterns, and see how far you've come! (This feature requires database integration on the backend.)</p>
                 </div>
        </section>
        <section id="save-note-page" class="page">
             <div>
                <h2>Save Note Page</h2>
                <p>This section will allow you to manage and review the note cards generated during your practice sessions. (This feature requires database integration on the backend.)</p>
                </div>
        </section>
    </div>


    <footer>&copy; 2025 Speech Analysis Tool. All rights reserved.</footer>


    <script>
        document.addEventListener('DOMContentLoaded', function() {


            // --- Get References to Practice Page Elements FIRST ---
            // Moved these declarations to the top to prevent initialization errors
            const feedbackContentDiv = document.getElementById('feedback-content');
            const wpmValueSpan = document.getElementById('wpm-value');
            const pacingValueSpan = document.getElementById('pacing-value');
            const fillerCountSpan = document.getElementById('filler-count');
            const transcriptDisplay = document.getElementById('transcript-display');
            const tipsList = document.getElementById('tips-list');
            const notesListDiv = document.getElementById('notes-list');
            const saveButton = document.getElementById('saveSpeechButton');


            // --- Page Navigation Logic ---
            const navLinks = document.querySelectorAll('#main-nav a[data-page], .cta-button[data-page]');
            const pages = document.querySelectorAll('.page');
            const mainNav = document.getElementById('main-nav');


            function showPage(pageId, triggeredByClick = false) { // Add flag to know if it's a click
                console.log(">>> showPage called with:", pageId, "Clicked:", triggeredByClick);
                pages.forEach(page => page.classList.remove('active'));
                const targetPage = document.getElementById(pageId);


                if (targetPage) {
                    targetPage.classList.add('active');
                    // Fetch data when practice page is shown
                    if (pageId === 'practice-page') {
                        console.log(">>> Practice page detected, calling fetch...");
                        fetchAndUpdatePracticeData();
                    }
                } else {
                    console.warn(`Page with ID "${pageId}" not found. Defaulting to home.`);
                    const homePage = document.getElementById('home-page');
                    if (homePage) homePage.classList.add('active'); // Default to home
                    pageId = 'home-page'; // Ensure pageId reflects the actual page shown
                }


                // Update nav active state
                if (mainNav) {
                     mainNav.querySelectorAll('a[data-page]').forEach(link => {
                         link.classList.remove('active');
                         if (link.getAttribute('data-page') === pageId) {
                            link.classList.add('active');
                         }
                     });
                 }


                 // *** FIXED SCROLL LOGIC ***
                 // Scroll to top unless it's the home page.
                 if (pageId !== 'home-page') {
                      // You could add more complex logic here using triggeredByClick if needed
                      window.scrollTo(0, 0);
                 }
            }


             navLinks.forEach(link => {
                 link.addEventListener('click', function(event) {
                     event.preventDefault();
                     const pageId = this.getAttribute('data-page');
                     const targetHref = this.getAttribute('href');
                     if (pageId) {
                         // Pass true for triggeredByClick flag
                         showPage(pageId, true);
                         if (targetHref.startsWith('#') && document.getElementById(pageId)) {
                             history.pushState({page: pageId}, null, targetHref);
                         }
                     } else if (targetHref === '#features') {
                          const featuresSection = document.querySelector('.features-section');
                          if (featuresSection) {
                              featuresSection.scrollIntoView({ behavior: 'smooth' });
                          }
                     }
                 });
             });


            // Handle back/forward navigation
            window.addEventListener('popstate', function(event) {
                let pageIdToShow = 'home-page';
                if (event.state && event.state.page) {
                    pageIdToShow = event.state.page;
                } else {
                    const hash = window.location.hash.substring(1);
                    if (hash) {
                         const potentialPageId = hash + '-page';
                         if (document.getElementById(potentialPageId)) {
                             pageIdToShow = potentialPageId;
                         }
                     }
                }
                 // Pass false for triggeredByClick when using browser history
                 showPage(pageIdToShow, false);
             });




            // --- Practice Page Specific Functions ---


            // Function to fetch data and update the practice page
            async function fetchAndUpdatePracticeData() {
                console.log("Fetching latest speech data...");
                setLoadingState(true); // Show loading indicators


                try {
                    const response = await fetch('/botapi/get-latest/'); // Fetch from the correct endpoint
                    if (!response.ok) {
                        let errorMsg = `HTTP error! status: ${response.status}`;
                        if (response.status === 404) errorMsg = "Error: Backend endpoint /botapi/get-latest/ not found (404). Check Django urls.py.";
                        else if (response.status === 500) errorMsg = "Error: Server error (500). Check Django server logs for /botapi/get-latest/.";
                        throw new Error(errorMsg);
                    }
                    const data = await response.json();
                    console.log("Successfully fetched data:", data);


                    // --- Update the HTML elements ---
                    if (wpmValueSpan) wpmValueSpan.textContent = data.wpm ?? 'N/A';
                    if (pacingValueSpan) pacingValueSpan.textContent = data.pacing ?? 'N/A';
                    if (fillerCountSpan) fillerCountSpan.textContent = data.filler_count ?? 'N/A';
                    if (transcriptDisplay) transcriptDisplay.value = data.transcript ?? 'No transcript available.';


                    if (feedbackContentDiv) {
                         feedbackContentDiv.innerHTML = ''; // Clear previous
                         const speechP = document.createElement('p');
                         speechP.innerHTML = `<strong>Speech:</strong> ${data.feedback_speech || 'No speech feedback provided.'}`;
                         const postureP = document.createElement('p');
                         postureP.innerHTML = `<strong>Posture:</strong> ${data.feedback_posture || 'No posture feedback provided.'}`;
                         feedbackContentDiv.appendChild(speechP);
                         feedbackContentDiv.appendChild(postureP);
                    }


                    if (tipsList) {
                         tipsList.innerHTML = ''; // Clear previous
                         const combinedFeedback = `${data.feedback_speech || ''} ${data.feedback_posture || ''}`;
                         const potentialTips = combinedFeedback.split(/[.]+/g).map(tip => tip.trim()).filter(tip => tip.length > 10);
                         if (potentialTips.length > 0) {
                              potentialTips.forEach(tipText => {
                                  const li = document.createElement('li');
                                  li.textContent = tipText + '.';
                                  tipsList.appendChild(li);
                              });
                         } else if (data.transcript && data.transcript !== 'N/A') { // Check if data was actually loaded
                             tipsList.innerHTML = '<li>Looks good! Keep practicing to refine further.</li>';
                         } else {
                              tipsList.innerHTML = '<li class="loading-block">No tips available yet.</li>';
                         }
                    }


                    if (notesListDiv) {
                         notesListDiv.innerHTML = ''; // Clear previous
                         if (data.notecards && Array.isArray(data.notecards) && data.notecards.length > 0 && data.notecards[0] !== 'N/A') {
                             data.notecards.forEach(noteText => {
                                 if (noteText) {
                                     const noteCard = document.createElement('div'); noteCard.className = 'note-card';
                                     const noteIcon = document.createElement('div'); noteIcon.className = 'note-icon'; noteIcon.textContent = 'üìù';
                                     const noteTextDiv = document.createElement('div'); noteTextDiv.className = 'note-text'; noteTextDiv.textContent = noteText;
                                     noteCard.appendChild(noteIcon); noteCard.appendChild(noteTextDiv);
                                     notesListDiv.appendChild(noteCard);
                                 }
                             });
                         } else if (data.transcript && data.transcript !== 'N/A') { // Check if data was actually loaded
                            notesListDiv.innerHTML = '<p>No specific note cards generated for this session.</p>';
                         } else {
                            notesListDiv.innerHTML = '<p class="loading-block">No note cards available yet.</p>';
                         }
                    }


                } catch (error) {
                    console.error('Error fetching or updating speech data:', error);
                    if (feedbackContentDiv) feedbackContentDiv.innerHTML = `<p style="color: #ff6b6b;">‚ö†Ô∏è Error loading feedback: ${error.message}</p>`;
                    if (tipsList) tipsList.innerHTML = `<li style="color: #ff6b6b;">‚ö†Ô∏è Error loading tips</li>`;
                    if (notesListDiv) notesListDiv.innerHTML = `<p style="color: #ff6b6b;">‚ö†Ô∏è Error loading notes</p>`;
                    if (wpmValueSpan) wpmValueSpan.textContent = 'Err';
                    if (pacingValueSpan) pacingValueSpan.textContent = 'Err';
                    if (fillerCountSpan) fillerCountSpan.textContent = 'Err';
                    if (transcriptDisplay) transcriptDisplay.value = `Error loading data: ${error.message}`;
                } finally {
                     setLoadingState(false); // Hide loading indicators
                }
            }


            // Helper function to manage loading indicators
            function setLoadingState(isLoading) {
                 const loadingTexts = document.querySelectorAll('.loading-text');
                 const loadingBlocks = document.querySelectorAll('.loading-block');


                 if (isLoading) {
                     loadingTexts.forEach(el => { if(el) el.style.display = 'inline'; });
                     loadingBlocks.forEach(el => { if(el) el.style.display = 'block'; });
                     if (wpmValueSpan) wpmValueSpan.textContent = '(...)';
                     if (pacingValueSpan) pacingValueSpan.textContent = '(...)';
                     if (fillerCountSpan) fillerCountSpan.textContent = '(...)';
                     if (transcriptDisplay) transcriptDisplay.value = 'Loading transcript...';
                     if (feedbackContentDiv) feedbackContentDiv.innerHTML = '<p class="loading-block">Loading feedback...</p>';
                     if (tipsList) tipsList.innerHTML = '<li class="loading-block">Loading tips...</li>';
                     if (notesListDiv) notesListDiv.innerHTML = '<p class="loading-block">Loading notes...</p>';
                     if (saveButton) saveButton.disabled = true;
                 } else {
                     loadingTexts.forEach(el => { if(el) el.style.display = 'none'; });
                     loadingBlocks.forEach(el => { if(el) el.style.display = 'none'; });
                     // Keep save button disabled until feature is implemented
                     // if (saveButton) saveButton.disabled = false;
                 }
            }


            // Save button functionality (Placeholder)
             if (saveButton) {
                 saveButton.addEventListener('click', function() {
                     console.log('Save Speech button clicked! (Functionality not implemented)');
                     showTemporaryMessage('Save Speech functionality is planned for a future update.');
                 });
             }


            // --- Utility Function ---
            function showTemporaryMessage(message) {
                const existingMessage = document.getElementById('temp-message-box');
                if (existingMessage) existingMessage.remove();
                const messageDiv = document.createElement('div');
                messageDiv.id = 'temp-message-box';
                messageDiv.textContent = message;
                messageDiv.style.position = 'fixed'; messageDiv.style.bottom = '20px'; messageDiv.style.left = '50%'; messageDiv.style.transform = 'translateX(-50%)';
                messageDiv.style.backgroundColor = 'var(--primary-purple)'; messageDiv.style.color = 'var(--text-color)'; messageDiv.style.padding = '12px 25px';
                messageDiv.style.borderRadius = '8px'; messageDiv.style.zIndex = '1001'; messageDiv.style.opacity = '1';
                messageDiv.style.transition = 'opacity 0.5s ease-out 2.5s'; messageDiv.style.boxShadow = '0 3px 10px rgba(0,0,0,0.3)';
                document.body.appendChild(messageDiv);
                setTimeout(() => {
                    messageDiv.style.opacity = '0';
                    setTimeout(() => { if (messageDiv.parentNode) { messageDiv.remove(); } }, 500);
                }, 3000);
            }




             // --- Initial Page Load ---
             let initialPageId = 'home-page';
             if (window.history.state && window.history.state.page) {
                  initialPageId = window.history.state.page;
             } else {
                  const initialHash = window.location.hash.substring(1);
                  if (initialHash) {
                      const potentialPageId = initialHash + '-page';
                      if (document.getElementById(potentialPageId)) initialPageId = potentialPageId;
                  }
             }
              // Ensure the initial URL reflects the state
             if (window.location.hash !== `#${initialPageId.replace('-page', '')}` && initialPageId !== 'home-page') {
                  history.replaceState({page: initialPageId}, null, `#${initialPageId.replace('-page', '')}`);
             } else if (initialPageId === 'home-page' && window.location.hash !== '#home' && window.location.hash !== '') {
                  history.replaceState({page: 'home-page'}, null, '#home');
             }
              // Call showPage for the initial load, indicate it's not from a click
              showPage(initialPageId, false);


            console.log('Speech Analysis page setup complete.');
        });
    </script>


</body>
</html>